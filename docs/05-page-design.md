# 页面设计与路由规划

## 1. 页面总览

```
AI代码审查系统
├── 登录页
├── 主框架Layout
│   ├── 仪表盘 (Dashboard)
│   ├── Git平台管理 (2页)
│   ├── 代码仓库管理 (3页)
│   ├── 仓库组管理 (3页)
│   ├── LLM配置管理 (4页)
│   ├── 通知渠道管理 (2页)
│   ├── Review记录 (2页)
│   ├── 自动修复管理 (3页)
│   └── 系统设置 (3页)
└── 404页面
```

**总计**: 23个页面

---

## 2. 路由设计

### 2.1 路由表

| 路径 | 组件 | 名称 | 权限 | 说明 |
|------|------|------|------|------|
| `/login` | Login | 登录页 | 公开 | 用户登录 |
| `/` | Layout | 主框架 | 需认证 | - |
| `/dashboard` | Dashboard | 仪表盘 | 需认证 | 数据概览 |
| **Git平台管理** |
| `/platform` | PlatformList | 平台列表 | 需认证 | 查看/管理Git平台 |
| `/platform/form/:id?` | PlatformForm | 平台表单 | 需认证 | 新增/编辑平台 |
| **代码仓库管理** |
| `/repository` | RepositoryList | 仓库列表 | 需认证 | 已导入的仓库 |
| `/repository/import` | RepositoryImport | 导入仓库 | 需认证 | 从Git平台导入 |
| `/repository/webhook/:id` | WebhookConfig | Webhook配置 | 需认证 | 配置Webhook |
| **仓库组管理** |
| `/group` | GroupList | 仓库组列表 | 需认证 | 查看/管理仓库组 |
| `/group/form/:id?` | GroupForm | 仓库组表单 | 需认证 | 新增/编辑仓库组 |
| `/group/prompt/:id` | PromptEditor | 提示词编辑 | 需认证 | 编辑提示词模板 |
| **LLM配置管理** |
| `/llm/provider` | LLMProviderList | LLM供应商列表 | 需认证 | 查看/管理供应商 |
| `/llm/provider/form/:id?` | LLMProviderForm | 供应商表单 | 需认证 | 新增/编辑供应商 |
| `/llm/model/:providerId` | LLMModelList | 模型列表 | 需认证 | 查看/管理模型 |
| `/llm/model/form/:id?` | LLMModelForm | 模型表单 | 需认证 | 新增/编辑模型 |
| **通知渠道管理** |
| `/notification` | NotificationList | 通知渠道列表 | 需认证 | 查看/管理渠道 |
| `/notification/form/:id?` | NotificationForm | 渠道表单 | 需认证 | 新增/编辑渠道 |
| **Review记录** |
| `/review` | ReviewList | Review列表 | 需认证 | 查看Review记录 |
| `/review/:id` | ReviewDetail | Review详情 | 需认证 | 查看详细信息 |
| **自动修复管理** |
| `/fix` | FixTaskList | 修复任务列表 | 需认证 | 查看所有修复任务 |
| `/fix/:id` | FixTaskDetail | 修复任务详情 | 需认证 | 查看任务详情 |
| `/fix/branch` | FixBranchManage | 分支管理 | 需认证 | 管理修复分支 |
| **系统设置** |
| `/settings/general` | SettingsGeneral | 通用设置 | admin | 系统通用配置 |
| `/settings/webhook` | SettingsWebhook | Webhook配置 | admin | 回调URL配置 |
| `/settings/user` | SettingsUser | 用户管理 | admin | 用户管理 |
| `/404` | NotFound | 404页面 | 公开 | 页面不存在 |

---

## 3. 页面详细设计

### 3.1 登录页 (Login)

**路由**: `/login`

**布局**:
```
┌─────────────────────────────────────┐
│                                     │
│         AI 代码审查系统              │
│                                     │
│    ┌─────────────────────────┐     │
│    │   用户名: [_________]    │     │
│    │   密  码: [_________]    │     │
│    │   [ 记住我 ]             │     │
│    │   [    登录    ]         │     │
│    └─────────────────────────┘     │
│                                     │
└─────────────────────────────────────┘
```

**功能**:
- 用户名/密码登录
- 记住登录状态 (LocalStorage)
- 返回JWT Token
- 登录失败提示

---

### 3.2 仪表盘 (Dashboard)

**路由**: `/dashboard`

**布局**:
```
┌─────────────────────────────────────────┐
│ 统计卡片区                              │
├───────────┬───────────┬─────────────────┤
│ 总仓库数   │ 活跃仓库   │ Review总数      │
│   120     │    80     │     1,245       │
├───────────┼───────────┼─────────────────┤
│ 修复任务   │ 通知渠道   │ LLM模型         │
│    45     │     5     │      8          │
└───────────┴───────────┴─────────────────┘

┌─────────────────────────────────────────┐
│ Review趋势图 (ECharts折线图)            │
│ 最近30天的Review数量变化                │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ 最近Review记录                          │
│ ┌──────────────────────────────────┐  │
│ │ 仓库A - 评分85 - 2023-12-01       │  │
│ │ 仓库B - 评分90 - 2023-12-01       │  │
│ └──────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

**数据展示**:
- 6个统计卡片 (ProCard)
- Review趋势图 (折线图)
- 最近Review列表 (Table)

---

### 3.3 Git平台列表 (PlatformList)

**路由**: `/platform`

**布局**:
```
┌─────────────────────────────────────────┐
│ Git平台配置              [ + 添加平台 ]  │
├─────────────────────────────────────────┤
│ 搜索: [________]   [查询] [重置]       │
├─────────────────────────────────────────┤
│ ProTable                                │
│ ┌────┬─────┬──────┬─────┬──────────┐  │
│ │名称│类型 │地址   │状态 │操作       │  │
│ ├────┼─────┼──────┼─────┼──────────┤  │
│ │公司│GitLab│xxx   │启用 │测试 编辑  │  │
│ │GitLab│     │     │     │删除       │  │
│ └────┴─────┴──────┴─────┴──────────┘  │
└─────────────────────────────────────────┘
```

**功能**:
- 列表展示 (ProTable)
- 搜索过滤
- 添加/编辑/删除
- 测试连接
- 启用/禁用开关

**列定义**:
- 名称
- 平台类型 (Tag: GitLab/GitHub/Gitea)
- 地址
- 状态 (启用/禁用 Switch)
- 操作 (测试连接、编辑、删除)

---

### 3.4 Git平台表单 (PlatformForm)

**路由**: `/platform/form/:id?`

**布局**:
```
┌─────────────────────────────────────────┐
│ 添加/编辑Git平台                        │
├─────────────────────────────────────────┤
│ ProForm                                 │
│ ┌─────────────────────────────────────┐│
│ │ 名称: [_______________]              ││
│ │ 平台类型: [▼ GitLab]                 ││
│ │ 地址: [_______________]              ││
│ │ Access Token: [_______________]      ││
│ │                                      ││
│ │ [取消] [测试连接] [保存]             ││
│ └─────────────────────────────────────┘│
└─────────────────────────────────────────┘
```

**字段**:
- 名称 (required)
- 平台类型 (required, select: GitLab/GitHub/Gitea)
- 地址 (required, url)
- Access Token (required, password)

**操作**:
- 取消 (返回列表)
- 测试连接 (调用API测试)
- 保存 (提交表单)

---

### 3.5 仓库导入页 (RepositoryImport)

**路由**: `/repository/import`

**布局**:
```
┌─────────────────────────────────────────┐
│ 导入代码仓库                            │
├─────────────────────────────────────────┤
│ 选择平台: [▼ 公司GitLab]  [获取仓库列表]│
├─────────────────────────────────────────┤
│ 搜索: [________]   [查询]              │
├─────────────────────────────────────────┤
│ ProTable (带选择)                       │
│ ┌─┬──────────┬──────────┬──────────┐  │
│ │□│仓库名     │完整路径   │默认分支   │  │
│ ├─┼──────────┼──────────┼──────────┤  │
│ │□│project-a │group/a   │main      │  │
│ │☑│project-b │group/b   │master    │  │
│ └─┴──────────┴──────────┴──────────┘  │
│ 已选择 2 个仓库   [批量导入] [全选]    │
└─────────────────────────────────────────┘
```

**功能**:
- 选择Git平台
- 获取仓库列表 (从平台API)
- 搜索过滤
- 多选仓库
- 批量导入

---

### 3.6 仓库组表单 (GroupForm)

**路由**: `/group/form/:id?`

**布局**:
```
┌─────────────────────────────────────────┐
│ 添加/编辑仓库组                         │
├─────────────────────────────────────────┤
│ ProForm                                 │
│ ┌─────────────────────────────────────┐│
│ │ 基础信息                             ││
│ │ 名称: [_______________]              ││
│ │ 描述: [_______________]              ││
│ │                                      ││
│ │ LLM配置                              ││
│ │ LLM模型: [▼ DeepSeek Chat]           ││
│ │                                      ││
│ │ 关联仓库                             ││
│ │ [选择仓库...] (Transfer穿梭框)       ││
│ │                                      ││
│ │ 通知渠道                             ││
│ │ [选择渠道...] (Checkbox Group)       ││
│ │                                      ││
│ │ 通知配置                             ││
│ │ ☑ 显示Commit信息                     ││
│ │ ☑ 显示评分                           ││
│ │ ☑ 显示修复建议                       ││
│ │                                      ││
│ │ [取消] [保存]                        ││
│ └─────────────────────────────────────┘│
└─────────────────────────────────────────┘
```

**表单分组**:
1. 基础信息 (name, description)
2. LLM配置 (llm_model_id)
3. 关联仓库 (repositories, Transfer组件)
4. 通知渠道 (notification_channels, Checkbox)
5. 通知配置 (notification_config, Checkbox)

---

### 3.7 提示词编辑器 (PromptEditor)

**路由**: `/group/prompt/:id`

**布局**:
```
┌─────────────────────────────────────────┐
│ 编辑提示词模板 - 仓库组名称             │
├─────────────────────────────────────────┤
│ [系统提示词] [用户提示词] [预览]        │
├─────────────────────────────────────────┤
│ MonacoEditor (YAML)                     │
│ ┌─────────────────────────────────────┐│
│ │ system_prompt: |                     ││
│ │   你是一个资深的{{language}}代码审查 ││
│ │   专家...                            ││
│ │                                      ││
│ │ user_prompt: |                       ││
│ │   请审查以下代码:                    ││
│ │   {{diffs_text}}                     ││
│ └─────────────────────────────────────┘│
│ [重置为默认] [预览] [保存]              │
└─────────────────────────────────────────┘
```

**功能**:
- Monaco Editor (YAML模式)
- 支持模板变量高亮
- 实时预览渲染结果
- 重置为默认模板

**模板变量**:
- `{{language}}`: 语言名称
- `{{diffs_text}}`: 代码差异
- `{{commits_text}}`: 提交信息

---

### 3.8 LLM模型列表 (LLMModelList)

**路由**: `/llm/model/:providerId`

**布局**:
```
┌─────────────────────────────────────────┐
│ LLM模型管理 - DeepSeek                  │
├─────────────────────────────────────────┤
│ [+ 手动添加] [动态获取模型列表]         │
├─────────────────────────────────────────┤
│ ProTable                                │
│ ┌──────────┬──────┬────┬──────────┐    │
│ │模型名     │显示名│Token│操作       │    │
│ ├──────────┼──────┼────┼──────────┤    │
│ │deepseek- │Deep- │10k │启用 编辑  │    │
│ │chat      │seek  │    │删除       │    │
│ └──────────┴──────┴────┴──────────┘    │
└─────────────────────────────────────────┘
```

**功能**:
- 手动添加模型
- 动态获取模型 (调用LLM Provider API)
- 批量导入
- 编辑/删除
- 启用/禁用

---

### 3.9 Review详情页 (ReviewDetail)

**路由**: `/review/:id`

**布局**:
```
┌─────────────────────────────────────────┐
│ Review详情 #12345                       │
├─────────────────────────────────────────┤
│ 基本信息                                │
│ 仓库: project-a  作者: zhangsan         │
│ 分支: feature -> main  评分: 85/100    │
│ 时间: 2023-12-01 10:30                 │
├─────────────────────────────────────────┤
│ [原始结果] [结构化结果] [修复建议]      │
├─────────────────────────────────────────┤
│ Tabs Content:                           │
│ ┌─────────────────────────────────────┐│
│ │ 修复建议 (15条)                      ││
│ │ ┌─────────────────────────────────┐ ││
│ │ │ 🔴 critical  src/utils/helper.go││ ││
│ │ │ 行号: 10-15                      ││ ││
│ │ │ 问题: 存在SQL注入风险            ││ ││
│ │ │ 建议: 使用参数化查询             ││ ││
│ │ │ [自动修复] [查看代码]            ││ ││
│ │ └─────────────────────────────────┘ ││
│ └─────────────────────────────────────┘│
└─────────────────────────────────────────┘
```

**Tabs**:
1. **原始结果**: Markdown渲染 AI 原始输出
2. **结构化结果**: JSON Tree展示解析后的数据
3. **修复建议**: FixSuggestionCard列表

**FixSuggestionCard**:
- 严重程度徽章 (critical/high/medium/low)
- 文件路径
- 行号范围
- 问题描述
- 修复建议
- 代码片段 (Monaco Diff Viewer)
- 操作按钮 (自动修复、查看代码)

---

### 3.10 修复任务详情 (FixTaskDetail)

**路由**: `/fix/:id`

**布局**:
```
┌─────────────────────────────────────────┐
│ 修复任务详情 #789                       │
├─────────────────────────────────────────┤
│ 状态: [🟢 Success]  耗时: 2m 30s        │
│ 建议: #456  仓库: project-a             │
│ 分支: ai-fix/suggestion-456-1234567890  │
│ Commit: abc123def456                    │
├─────────────────────────────────────────┤
│ [执行日志] [修复详情] [分支管理]        │
├─────────────────────────────────────────┤
│ 执行日志 (WebSocket实时流)              │
│ ┌─────────────────────────────────────┐│
│ │ [INFO] 2023-12-01 10:30:00         ││ │
│ │ 开始执行自动修复任务                ││ │
│ │ [INFO] 2023-12-01 10:30:05         ││ │
│ │ 克隆仓库到本地...                   ││ │
│ │ [INFO] 2023-12-01 10:30:30         ││ │
│ │ 创建修复分支 ai-fix/...             ││ │
│ │ [INFO] 2023-12-01 10:31:00         ││ │
│ │ 执行Snow-CLI修复...                 ││ │
│ │ [INFO] 2023-12-01 10:32:00         ││ │
│ │ 提交修复代码...                     ││ │
│ │ [INFO] 2023-12-01 10:32:30         ││ │
│ │ 推送到远程仓库                      ││ │
│ │ [INFO] 2023-12-01 10:32:45         ││ │
│ │ ✅ 修复任务完成                     ││ │
│ └─────────────────────────────────────┘│
│ [重新修复] [标记忽略] [查看分支]        │
└─────────────────────────────────────────┘
```

**功能**:
- 实时日志流 (WebSocket)
- 日志级别颜色区分
  - INFO: 默认
  - WARNING: 橙色
  - ERROR: 红色
  - DEBUG: 灰色
- 操作按钮:
  - 重新修复 (需求22)
  - 标记忽略 (需求20)
  - 查看分支 (跳转到分支管理)

---

### 3.11 修复分支管理 (FixBranchManage)

**路由**: `/fix/branch`

**布局**:
```
┌─────────────────────────────────────────┐
│ 修复分支管理                            │
├─────────────────────────────────────────┤
│ 筛选: 仓库[▼] 状态[▼] [查询] [重置]   │
├─────────────────────────────────────────┤
│ ProTable                                │
│ ┌──────┬────────┬─────┬────────────┐   │
│ │分支名│基础分支│状态 │操作         │   │
│ ├──────┼────────┼─────┼────────────┤   │
│ │ai-fix│main    │未合并│合并 删除   │   │
│ │/sug- │        │     │            │   │
│ │456   │        │     │            │   │
│ └──────┴────────┴─────┴────────────┘   │
└─────────────────────────────────────────┘
```

**列定义**:
- 分支名称
- 基础分支
- 关联MR/PR URL (链接)
- 状态 (未合并/已合并/已删除 Tag)
- 操作:
  - 合并分支 (需求24)
  - 删除分支 (需求23)
  - 创建MR/PR

**合并分支对话框**:
```
┌─────────────────────────────────┐
│ 合并修复分支                     │
├─────────────────────────────────┤
│ 分支: ai-fix/suggestion-456     │
│ 目标: main                      │
│                                 │
│ 合并方式:                       │
│ ○ Merge Commit                 │
│ ● Squash (推荐)                │
│ ○ Rebase                       │
│                                 │
│ ☑ 合并后删除分支                │
│                                 │
│ [取消] [确认合并]               │
└─────────────────────────────────┘
```

---

## 4. 页面组件清单

### 4.1 Ant Design Pro组件使用

| 组件 | 用途 | 使用页面 |
|------|------|---------|
| ProTable | 数据表格 | 所有列表页 |
| ProForm | 表单 | 所有表单页 |
| ProCard | 卡片容器 | Dashboard |
| ProDescriptions | 描述列表 | 详情页 |
| PageContainer | 页面容器 | 所有页面 |

### 4.2 自定义组件

| 组件名 | 功能 | 使用场景 |
|--------|------|---------|
| CodeDiff | 代码差异对比 | Review详情 |
| MarkdownViewer | Markdown渲染 | Review原始结果 |
| LogViewer | 日志查看器 | 修复任务详情 |
| FixSuggestionCard | 修复建议卡片 | Review详情 |
| PromptEditor | 提示词编辑器 | 提示词编辑 |
| StatusBadge | 状态徽章 | 列表页 |

---

## 5. 页面交互规范

### 5.1 列表页交互

1. **搜索过滤**: 立即触发查询
2. **分页**: 支持跳转、改变每页数量
3. **操作确认**: 删除操作需要二次确认
4. **批量操作**: 支持多选批量处理

### 5.2 表单页交互

1. **实时验证**: 失焦时验证字段
2. **提交前验证**: 所有字段验证通过才能提交
3. **加载状态**: 提交时显示loading
4. **成功反馈**: 提交成功后提示并返回列表

### 5.3 详情页交互

1. **Tab切换**: 记住当前Tab状态
2. **数据刷新**: 提供刷新按钮
3. **操作反馈**: 操作后即时更新状态

---

**下一步**: 页面交互逻辑设计
